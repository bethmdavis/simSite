/**
 * @license
 * Copyright 2012 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */

/**
 * @fileoverview Generating Python for variable blocks.
 * @author q.neutron@gmail.com (Quynh Neutron)
 */
 'use strict';


 

//This block creates a new robot
Blockly.Python['new_robot'] = function(block) {
  var text_name = block.getFieldValue('name');
  var number_x_val = block.getFieldValue('x_val');
  var number_y_val = block.getFieldValue('y_val');
  var angle_theta = block.getFieldValue('theta');
  var robot_color = Blockly.Python.valueToCode(block, 'color', Blockly.Python.ORDER_ATOMIC);
  if (robot_color == '') robot_color = '"black"';
   var code = `
curName = "`+text_name+`"
drawing = -1
message = 0
robotMoveObj.New_Robot(curName, `+number_x_val+`, `+number_y_val+`, `+angle_theta+`, `+robot_color+`, drawing)
`;
   return code;
 };

//This block runs the robot to a point and angle
Blockly.Python['run_to_point_and_angle'] = function(block) {
   var number_target_x = block.getFieldValue('target_x');
   var number_target_y = block.getFieldValue('target_y');
   var angle = block.getFieldValue('angle');   
   var code = "robotMoveObj.Add_Target_Point(curName, "+number_target_x+", "+number_target_y+", "+angle+", drawing, message)\n";
   return code;
 };

//This block runs the robot to a point and angle
Blockly.Python['run_to_point'] = function(block) {
  var number_target_x = block.getFieldValue('target_x');
  var number_target_y = block.getFieldValue('target_y');
  var code = "robotMoveObj.Add_Target_Point(curName, "+number_target_x+", "+number_target_y+", 0, drawing, message)\n";
  return code;
};

//This block puts the robots "pen" down
Blockly.Python['pen_down'] = function(block) {
  var color = Blockly.Python.valueToCode(block, 'color', Blockly.Python.ORDER_ATOMIC);
  if (color == "") color = "'#000000'";
  color = color.slice(2,-1);
  color = parseInt(color,16);
  var code = `
drawing = `+color+`
`;
  return code;
};

//This block pulls the robots "pen" up
Blockly.Python['pen_up'] = function(block) {
  var code = "drawing = -1\n";
  return code;
};

Blockly.Python['new_polygon'] = function(block) {
  var number_sides = block.getFieldValue('sides');
  var number_x = block.getFieldValue('x');
  var number_y = block.getFieldValue('y');
  var number_radius = block.getFieldValue('radius');
  var angle_angle = block.getFieldValue('angle');
  var value_color = Blockly.Python.valueToCode(block, 'color', Blockly.Python.ORDER_ATOMIC);
  if (value_color == "") value_color = "'#000000'";
  var code = `robotMoveObj.Add_Polygon_Shapes(`+number_x+`, `+number_y+`, `+number_sides+`, `+number_radius+`, orientation=`+String(angle_angle*Math.PI/180)+`, color=`+value_color+`, zorder=-10)\n`;
  return code;
};

//This block changes the drawing type between actual or initial
Blockly.Python['drawing_type'] = function(block) {
  var dropdown_d_type = block.getFieldValue('D_type');
  var code = "robotMoveObj.drawingType = \""+dropdown_d_type+"\"\n";
  return code;
};

Blockly.Python['new_circle'] = function(block) {
  var number_x = block.getFieldValue('x');
  var number_y = block.getFieldValue('y');
  var number_radius = block.getFieldValue('radius');
  var value_color = Blockly.Python.valueToCode(block, 'color', Blockly.Python.ORDER_ATOMIC);
  if (value_color == "") value_color = "'#000000'";
  var code = `robotMoveObj.Add_Circle_Shapes(`+number_x+`, `+number_y+`, `+number_radius+`, color=`+value_color+`, zorder=-10)\n`;
  return code;
};

Blockly.Python['new_rec'] = function(block) {
  var number_x = block.getFieldValue('x');
  var number_y = block.getFieldValue('y');
  var number_w = block.getFieldValue('w');
  var number_h = block.getFieldValue('h');
  var angle_name = block.getFieldValue('NAME');
  var value_color = Blockly.Python.valueToCode(block, 'color', Blockly.Python.ORDER_ATOMIC);
  if (value_color == "") value_color = "'#000000'";
  var code = `robotMoveObj.Add_Rectangle_Shapes(`+number_x+`, `+number_y+`, width=`+number_w+`, height=`+number_h+`, angle=`+String(angle_name)+`, color=`+value_color+`, zorder=-10)\n`;
  return code;
}; 

Blockly.Python['new_line'] = function(block) {
  var number_fx = block.getFieldValue('fx');
  var number_fy = block.getFieldValue('fy');
  var number_tx = block.getFieldValue('tx');
  var number_ty = block.getFieldValue('ty');
  var value_color = Blockly.Python.valueToCode(block, 'color', Blockly.Python.ORDER_ATOMIC);
  if (value_color == "") value_color = "'#000000'";
  var code = `robotMoveObj.Add_Lines(`+number_fx+`, `+number_tx+`, `+number_fy+`, `+number_ty+`, color=`+value_color+`, zorder=-10)\n`;
  return code;
};

//This block makes the robot turn by heading
Blockly.Python['turn_by_angle'] = function(block) {
  var angle_angle = block.getFieldValue('angle');
  var code = "robotMoveObj.Turn(curName, "+angle_angle+", drawing, message)\n";
  return code;
};

//This block makes the robot move forward by distance
Blockly.Python['move_forward'] = function(block) {
  var number_distance = block.getFieldValue('distance');
  var code = "robotMoveObj.Move_Forward(curName, "+number_distance+", drawing, message)\n";
  return code;
}; 

//This block makes the robot wait a specified time
Blockly.Python['wait'] = function(block) {
  var seconds = block.getFieldValue('seconds');
  var miliseconds = seconds * 1000
  miliseconds = parseInt((miliseconds + 3) * -1)
  var code = `robotMoveObj.Move_Forward(curName, 0, `+miliseconds+`, message)\n`;
  return code;
}; 

//This block places an image
Blockly.Python['display_image'] = function(block) {
  var dropdown_image = block.getFieldValue('image');
  var number_x = block.getFieldValue('x');
  var number_y = block.getFieldValue('y');
  var number_s = block.getFieldValue('s');
  var code = `
#image@`+dropdown_image+`&
robotMoveObj.Add_Images('`+dropdown_image+`.png', `+number_x+`, `+number_y+`, `+number_s+`)
`;
  return code;
};

Blockly.Python['display_Maze'] = function(block) {
  var dropdown_maze = block.getFieldValue('maze');
  var code = `
#image@maze`+dropdown_maze+`&
robotMoveObj.Add_Maze('`+dropdown_maze+`.png')
robotMoveObj.ifMaze = True
robotMoveObj.mazeNum = `+dropdown_maze+`
`;
  return code;
};

//This block turns to a specific heading
Blockly.Python['turn_to'] = function(block) {
  var angle_angle = block.getFieldValue('angle');
  var code = "robotMoveObj.Turn_To(curName, "+angle_angle+", drawing, message)\n";
  return code;
};

Blockly.Python['send_message'] = function(block) {
  var value_message = block.getFieldValue('message');
  var code = `robotMoveObj.Send_Messages(curName, drawing, message, "`+value_message+`")\n`;
  return code;
};

Blockly.Python['wait_until_message'] = function(block) {
  var value_message = block.getFieldValue('message');
  var code = `message = robotMoveObj.Wait_Until_Message("`+value_message+`")\n`;
  return code;
};